<!DOCTYPE html>
<html lang="en-us">
<title>函数式编程初体验 （1） | 子不语</title>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.90.1" />
<meta name="description" content="分享了函数式编程的一些基本概念，使用 Haskell 编写简单函数演示函数式编程基本概念">
<meta name="baidu-site-verification" content="AAd4ZRAjIO">
<meta name="keywords" content="Functional Programming, Haskell, 函数式编程">
<meta name="robots" content="index,follow"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="apple-touch-icon" sizes="180x180" href="https://ddou.github.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://ddou.github.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://ddou.github.io/favicon-16x16.png">
<link rel="manifest" href="https://ddou.github.io/site.webmanifest">
<link rel="stylesheet" href="https://ddou.github.io/css/minimal.css">
<link rel="canonical" href="https://ddou.github.io/posts/functional-programming-in-real-world/">
<link rel="alternate" type="application/rss+xml" href="" title="子不语">

<header>
  
    <a href="https://ddou.github.io/" class="title">子不语</a>
  
  
    <nav>
    
      <a href="https://ddou.github.io/">文章</a>
    
      <a href="https://ddou.github.io/tags/">标签</a>
    
      <a href="https://ddou.github.io/about/">关于</a>
    
      <a href="https://ddou.github.io/index.xml">订阅</a>
    
    </nav>
  
</header>

<article>
  <header>
    <h1>函数式编程初体验 （1）</h1>
    <time
      datetime="2016-02-27T21:58:43&#43;08:00">February 27, 2016</time>
      

<small><code><a href="https://ddou.github.io/tags/functional-programming">Functional Programming</a></code></small>


<small><code><a href="https://ddou.github.io/tags/haskell">Haskell</a></code></small>

  </header>
  <p>在之前的两篇函数式编程语言特性的文章（<a href="https://ddou.github.io/posts/functional-programming-concepts/">上篇</a>和<a href="https://ddou.github.io/posts/functional-programming-concepts-part-two/">下篇</a>）中简单介绍了一些基本的函数式编程的概念。对函数式编程有了一些基本的概念，那现实中的函数式编程是什么样子的呢？这里就选取一个比较简单的问题，使用 Haskell 尝试解决一下，以求近距离的感受下函数之美。</p>
<h3 id="问题">问题</h3>
<p>这里采用的是我司一个废弃了很久的面试题目 MarsRover，题目内容如下：</p>
<blockquote>
<p>A squad of robotic rovers are to be landed by NASA on a plateau on Mars. This plateau, which is curiously rectangular, must be navigated by the rovers so that their on-board cameras can get a complete view of the surrounding terrain to send back to Earth. A rover&rsquo;s position and location is represented by a combination of x and y co-ordinates and a letter representing one of the four cardinal compass points. The plateau is divided up into a grid to simplify navigation. An example position might be 0, 0, N, which means the rover is in the bottom left corner and facing North. In order to control a rover, NASA sends a simple string of letters. The possible letters are &lsquo;L&rsquo;, &lsquo;R&rsquo; and &lsquo;M&rsquo;. &lsquo;L&rsquo; and &lsquo;R&rsquo; makes the rover spin 90 degrees left or right respectively, without moving from its current spot. &lsquo;M&rsquo; means move forward one grid point, and maintain the same heading.</p>
</blockquote>
<blockquote>
<p>Assume that the square directly North from (x, y) is (x, y+1).</p>
</blockquote>
<p>大意是</p>
<blockquote>
<p>在直角坐标系内，有一个探测器，探测器有三个状态，X 和 Y 标记探测器所在位置，Direction 标记了探测器的前进方向。科学家发送指令 L, R, M 给探测器，分别表示左转 90 度，右转 90 度和前进。 问题就是给定一个初始条件，和一系列命令，求解探测器最终状态。</p>
</blockquote>
<p>下面我们看使用 Haskell 如何解决上述问题。</p>
<h3 id="求解">求解</h3>
<p>首先，我们需要定义一些基本的数据类型。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-haskell" data-lang="haskell"><span style="color:#75715e">-- 北，东，南，西</span>
<span style="color:#66d9ef">data</span> <span style="color:#66d9ef">Direction</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">N</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">E</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">S</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">W</span>
    <span style="color:#66d9ef">deriving</span> (<span style="color:#66d9ef">Show</span>)

<span style="color:#75715e">-- 左转，右转，和移动</span>
<span style="color:#66d9ef">data</span> <span style="color:#66d9ef">Command</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">L</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">R</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">M</span>
    <span style="color:#66d9ef">deriving</span> (<span style="color:#66d9ef">Show</span>)

<span style="color:#75715e">-- 位置</span>
<span style="color:#66d9ef">type</span> <span style="color:#66d9ef">Point</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Int</span>)

<span style="color:#75715e">-- 探测器</span>
<span style="color:#66d9ef">data</span> <span style="color:#66d9ef">MarsRover</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">MarsRover</span> <span style="color:#66d9ef">Point</span> <span style="color:#66d9ef">Direction</span>
    <span style="color:#66d9ef">deriving</span> (<span style="color:#66d9ef">Show</span>)
</code></pre></div><p>上述定义中的 deriving (Show)类似于我们常见的 toString。Haskll 中定义的类型只有加了上述定义后，才会把对应的数据结构转换成字符串，输出到控制台，才能方便调试以及查看结果。</p>
<p>然后，我们可以定义三个函数 turnLeft、turnRight 和 move，分别对应对探测器的三个操作。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-haskell" data-lang="haskell"><span style="color:#a6e22e">turnLeft</span> <span style="color:#f92672">::</span> <span style="color:#66d9ef">MarsRover</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span>
<span style="color:#a6e22e">turnLeft</span> rover <span style="color:#f92672">=</span> <span style="color:#66d9ef">case</span> rover <span style="color:#66d9ef">of</span>
        <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">N</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">W</span>
        <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">W</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">S</span>
        <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">S</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">E</span>
        <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">E</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">N</span>

<span style="color:#a6e22e">turnRight</span> <span style="color:#f92672">::</span> <span style="color:#66d9ef">MarsRover</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span>
<span style="color:#a6e22e">turnRight</span> rover <span style="color:#f92672">=</span>
    <span style="color:#66d9ef">case</span> rover <span style="color:#66d9ef">of</span>
        <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">N</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">E</span>
        <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">W</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">N</span>
        <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">S</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">W</span>
        <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">E</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span> p <span style="color:#66d9ef">S</span>

<span style="color:#a6e22e">move</span> <span style="color:#f92672">::</span> <span style="color:#66d9ef">MarsRover</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span>
<span style="color:#a6e22e">move</span> rover <span style="color:#f92672">=</span>
    <span style="color:#66d9ef">case</span> rover <span style="color:#66d9ef">of</span>
        <span style="color:#66d9ef">MarsRover</span> (x, y) <span style="color:#66d9ef">N</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span> (x, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">N</span>
        <span style="color:#66d9ef">MarsRover</span> (x, y) <span style="color:#66d9ef">E</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span> (x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y) <span style="color:#66d9ef">E</span>
        <span style="color:#66d9ef">MarsRover</span> (x, y) <span style="color:#66d9ef">W</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span> (x<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, y) <span style="color:#66d9ef">W</span>
        <span style="color:#66d9ef">MarsRover</span> (x, y) <span style="color:#66d9ef">S</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span> (x, y<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">S</span>
</code></pre></div><p>三个函数定义都是我们之前提到的<strong>纯函数</strong>，函数中使用了<strong>模式匹配</strong>以获取结构体中数据。下述模式匹配的部分实现虽略有繁琐，但逻辑清晰明了。与我们常用的 if-else 或者 switch 语句相比较，模式匹配的语法也更简洁。MarsRover 类型也是<strong>不可变</strong>的，每次操作都会返回一个新的实例。</p>
<p>我们下面再定义个 execute 函数，略微做下封装。execute 函数本身并没有太多逻辑，只是针对不同 command 做分发，调用对应的操作函数。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-haskell" data-lang="haskell"><span style="color:#a6e22e">execute</span> <span style="color:#f92672">::</span> <span style="color:#66d9ef">MarsRover</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Command</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">MarsRover</span>
<span style="color:#a6e22e">execute</span> rover command <span style="color:#f92672">=</span>
    <span style="color:#66d9ef">case</span> command <span style="color:#66d9ef">of</span>
        <span style="color:#66d9ef">L</span> <span style="color:#f92672">-&gt;</span> turnLeft rover
        <span style="color:#66d9ef">R</span> <span style="color:#f92672">-&gt;</span> turnRight rover
        <span style="color:#66d9ef">M</span> <span style="color:#f92672">-&gt;</span> move rover
</code></pre></div><p>上述定义了我们所需函数，到了展示我们工作成果的时候了：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-haskell" data-lang="haskell"><span style="color:#a6e22e">main</span> <span style="color:#f92672">::</span> <span style="color:#66d9ef">IO</span>()
<span style="color:#a6e22e">main</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">do</span>
    putStrLn <span style="color:#f92672">$</span> show <span style="color:#f92672">$</span> move<span style="color:#f92672">.</span>turnLeft<span style="color:#f92672">.</span>move<span style="color:#f92672">.</span>turnRight<span style="color:#f92672">.</span>move <span style="color:#f92672">$</span> <span style="color:#66d9ef">MarsRover</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">S</span>
    <span style="color:#75715e">-- 输出结果: MarsRover (-1,-2) S</span>
</code></pre></div><p>上面我们给定了探测器的初始条件为<strong>坐标(0，0)南向</strong>，然后执行了下列操作：</p>
<ol>
<li>前移</li>
<li>右转</li>
<li>前移</li>
<li>左转</li>
<li>前移</li>
</ol>
<p>然后我们将探测器的状态转换为字符串输出至控制台，结果为 MarsRover (-1,-2) S， 完全正确。</p>
<p>太棒了，简单 43 行代码，我们就用 hanskell 完成了题目的功能。我们完成了以下任务：</p>
<ul>
<li>定义了基本几个<strong>数据类型</strong></li>
<li>定义一系列<strong>纯函数</strong></li>
<li>使用了<strong>模式匹配</strong>来实现代码功能。</li>
<li>在最后验证的部分，我们利用了函数式编程中<strong>高阶函数</strong>的特性，使用 haskll 中的<strong>函数组合</strong>函数(.)把对探测器的多步操作组合为一个函数。 比起 Java 等其他语言中一个一个的函数调用是不是酷帅多了？</li>
</ul>
<p>有兴趣看代码的同学，可以查看<a href="https://github.com/yutaodou/functional-programming-via-haskell/blob/3758effe6b2b97a60d7fc4b9b1ac6aae287da58b/examples/mars-rover.hs">完整代码</a></p>
<p>这里我们只实现了部分功能，<a href="https://ddou.github.io/posts/functional-programming-in-real-world-2/">下篇</a>我们来尝试下从字符串解析命令来执行!</p>
<p>本篇文章是函数式编程系列之一：</p>
<ol>
<li><a href="https://ddou.github.io/posts/functional-programming-concepts/">函数式编程 101</a></li>
<li><a href="https://ddou.github.io/posts/functional-programming-concepts-part-two/">函数式编程 101 (续)</a></li>
<li>函数式编程初体验 一</li>
<li><a href="https://ddou.github.io/posts/functional-programming-in-real-world-2/">函数式编程初体验 二</a></li>
<li><a href="https://ddou.github.io/posts/functional-programming-in-real-world-3/">函数式编程初体验 三</a></li>
</ol>

</article>

<script src="https://utteranc.es/client.js"
        repo="ddou/ddou.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

<style>
    div.utterances {
        max-width: 80%;
        width: 60%;
    }
</style>

<script>
    (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-40664887-1' , { 'siteSpeedSampleRate': 100 });
    ga('send', 'pageview');
    ga('set', 'anonymizeIp', true);
</script>



</html>
